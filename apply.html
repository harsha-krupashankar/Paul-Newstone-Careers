<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.13/lottie.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <title>Jobs</title>
    <style>
        /* Configurations */
        :root{
            --color-primary: #3f4348;
            --color-secondary: #8a8a8a;
            --color-tertiary: #d80606;
            --color-light-1: #ffffff;
            --color-light-2: #fafafa;

            --color-text-light-1: #ffffff;
            --color-text-light-2: #fafafa;
            --color-text-dark-1: #6e6e6e;
            --color-text-dark-2: #424242;
            --color-text-dark-3: #000000;
            --color-text-link: #116dff;

            --color-background-light-1: #ffffff;
            --color-background-light-2: #fafafa;
            --color-background-dark-1: #1b1c1e;
            --color-background-dark-2: #141416;
            --color-background-tertiary-light: #D80606;
            --color-background-tertiary-dark: #990000;

            --color-grey-light-1: #faf9f9;
            --color-grey-light-2: #f7f7f7;
            --color-grey-light-3: #f0eeee;
            --color-grey-light-4: #ccc;
            
            --color-grey-dark-1: #333;
            --color-grey-dark-2: #777;
            --color-grey-dark-3: #999;
        }
        /* * {
            box-sizing: border-box;
        } */

        body{
            margin: 0;
            padding: 0;
        }

        *,
        *::before,
        *::after {
            box-sizing: inherit;
        }

        html {
            box-sizing: border-box;
            font-size: 62.5%; 
            font-family: "Open Sans", sans-serif;

            @media only screen and (max-width: 68.75em) {
                font-size: 50%;
            }
        }



        /* Styling */
        .header-container{
            background-color: var(--color-background-dark-1);
            padding: 2rem;
        }

        .header{
            height: 24rem;
            margin: 0 auto;
            /* margin-bottom: 4rem; */
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* padding-bottom: 1.4rem; */
            max-width: 126.5rem;
            /* padding: 0 2rem; */
            
        }
        .header-main{
            display: flex;
            flex-direction: column;
            gap: 1rem;
            /* margin-left: 1rem; */
        }
        .job-name{
            font-size: 5rem;
            font-weight: 400;
            margin-bottom: 1rem;
            margin-left: 0.5rem;
            color: var(--color-text-light-1);
            max-width: 100rem;
        }


        .tags{
            display: flex;
            color: var(--color-text-light-2);
        }

        .tags .tag{
            font-size: 1.8rem;
            font-weight: 300;
            padding: 0;
            margin: 0.5rem;
            display: flex;
            gap: 0.6rem;
            align-items: center;
        }

        .tag:not(:last-child){
            margin-right: 2rem;
        }
        .icon {
            font-size: 2.4rem;
            color: var(--color-secondary);
        }

        .action-btns{
            display: flex;
            flex-direction: column;
            margin-top: 2.8rem;
            margin-right: 0rem;
            gap: 1rem;
        }

        .custom-btn {
            width: 20rem;
            height: 4rem;
            color: var(--color-light-1);
            border-radius: 0.2rem;
            padding: 1rem 2.5rem;
            font-size: 1.6rem;
            font-weight: 400;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            display: inline-block;
            outline: none;
            z-index: 1;
            overflow: hidden;
        }

        .custom-btn:after {
            position: absolute;
            content: "";
            width: 0;
            height: 100%;
            top: 0;
            right: 0;
            z-index: -2;
            transition: all 0.5s ease;
        }

        .custom-btn:hover:after {
            left: 0;
            width: 100%;
        }
            
        .custom-btn:active {
            top: 2px;
        }

        .btn-apply {
            background: var(--color-tertiary);
            border: 1px solid var(--color-text-light-1);
            color: var(--color-light-1);
        }

        .btn-apply:after {
            background-color: var(--color-light-1); 
        }

        .btn-apply:hover {
            color: var(--color-text-dark-3);
        }
            
        

        .btn-back {
            background: transparent;
            border: 1px solid var(--color-text-light-1);
            color: var(--color-text-light-1);
            overflow: hidden;
        }

        .btn-back:after {
            background-color: var(--color-tertiary);
        }

        .btn-back:hover {
            color: var(--color-light-1);
        }


        .btn-submit {
            background: var(--color-background-light-1);
            border: 1px solid var(--color-text-dark-3);
            color: var(--color-text-dark-3);
        }

        .btn-submit:after {
            background-color: var(--color-text-dark-2);
        }

        .btn-submit:hover {
            color: var(--color-light-1);
        }

        .container{
            max-width: 130rem;
            margin: 0rem auto;
            padding: 6rem 2rem;
            display: grid;
            grid-template-rows: min-content min-content repeat(3, min-content) ;
            grid-template-columns: [full-start] minmax(6rem, 1fr) [center-start] repeat(8, [col-start] minmax(min-content, 14rem) [col-end]) [center-end] minmax(6rem, 1fr) [full-end];
        }

        .job-description > *{
            line-height: 2rem;
        }

        .job-description{
            grid-column: full-start / col-end 5;
            color: var(--color-text-dark-2);
            text-align: justify;
        }

        .job-apply{
            grid-column: full-start / col-end 5;
            grid-row: 2/3;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 4rem;
            position: relative;
            transition: transform 0.5s, opacity 0.5s;
        }


        .cards{
            grid-column: col-end 6 / full-end;
            grid-row: 1 / -1;
            /* margin-top: 2rem; */
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        
        .info-card{
            padding: 2rem 2rem;
            border-radius: 2px;
            background-color: var(--color-background-light-2);
            /* display: hidden; */
            transition: transform 1s, opacity 1s;
        }
        
        .card-text{
            color: var(--color-text-dark-2);
            font-size: 1.6rem;
            line-height: 2rem;
            margin-top: 1rem;
            font-weight: 300;
        }
        .result{
            background: linear-gradient(69deg, #D80606 54.6875%, #FD6262 100%);
        
        }


            
        .strong{
            color: var(--color-text-dark-2);
            font-weight: 400;
            display: inline-block;
        }
        .result-text{
                color: var(--color-light-1);
            }
        .card-order-list{
            margin-left: -2rem;
        }

        .card-order-list > li{
            margin-top: 1rem;
        }

        .contact-email{
            color: var(--color-text-link);
            text-decoration: none;
            /* white-space: nowrap; */
        }

        .divider{
            border: none;
            height: 1px;
            background-color: var(--color-grey-dark-3);
            margin: 1.8rem 0;
        }

        .divider-large{
            width: 90%;
            margin: 2.4rem auto;
        }



        .social-icons {
        margin:0;
        padding:0;
        display:flex;
        }
        .social-icons li {
        list-style:none;
        }
        .social-icons li a {
        display:block;
        position:relative;
        width:4rem;
        height:4rem;
        line-height:4.4rem;
        font-size:2rem;
        text-align:center;
        text-decoration:none;
        color:var(--color-text-dark-1); 
        margin: 1rem 1rem;
        transition:.5s;
        }
        .social-icons li a span {
        position:absolute;
        transition: transform .5s;
        }
        .social-icons li a span:nth-child(1),
        .social-icons li a span:nth-child(3){
        width:100%;
        height:2px;
        background:var(--color-text-dark-1);
        }
        .social-icons li a span:nth-child(1) {
        top:0;
        left:0;
        transform-origin: right;
        }
        .social-icons li a:hover span:nth-child(1) {
        transform: scaleX(0);
        transform-origin: left;
        transition:transform .5s;
        }

        .social-icons li a span:nth-child(3) {
        bottom:0;
        left:0;
        transform-origin: left;
        }
        .social-icons li a:hover span:nth-child(3) {
        transform: scaleX(0);
        transform-origin: right;
        transition:transform .5s;
        }

        .social-icons li a span:nth-child(2),
        .social-icons li a span:nth-child(4){
        width:2px;
        height:100%;
        background:var(--color-text-dark-1);
        }
        .social-icons li a span:nth-child(2) {
        top:0;
        left:0;
        transform:scale(0);
        transform-origin: bottom;
        }
        .social-icons li a:hover span:nth-child(2) {
        transform: scale(1);
        transform-origin: top;
        transition:transform .5s;
        }
        .social-icons li a span:nth-child(4) {
        top:0;
        right:0;
        transform:scale(0);
        transform-origin: top;
        }
        .social-icons li a:hover span:nth-child(4) {
        transform: scale(1);
        transform-origin: bottom;
        transition:transform .5s;
        }

        .facebook:hover {
        color: #3b5998;
        }
        .facebook:hover span { 
        background: #3b5998;
        }
        .twitter:hover {
        color: #1da1f2;
        }
        .twitter:hover span { 
        background: #1da1f2;
        }
        .instagram:hover {
        color: #c32aa3;
        }
        .instagram:hover span { 
        background: #c32aa3;
        }
        .google:hover {
        color: #dd4b39;
        }
        .google:hover span { 
        background: #dd4b39;
        }
        .social-icons li a .twitter {
        color: #1da1f2;
        }
        .social-icons li a:hover:nth-child(3) {
        color: #c32aa3;
        }
        .social-icons li a:hover:nth-child(4) {
        color: #dd4b39;
        }


        /* Application Form */
        .apply-to-job{
            font-size: 3rem;
            font-weight: 600;
            text-align: center;
            margin: 3rem 0;
            color: var(--color-primary);
        }

        .form{
            max-width: 90%;
            width: 90%;
        }

    .form-row{
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }

.form__group {
	 position: relative;
	 padding: 1rem 0;
	 margin-bottom: 1rem;
     flex: 1;
     min-width: 24rem;
}
.form__group:not(last-child){
    margin: 0.3rem 1.5rem;
}

 .form__field {
	 font-family: inherit;
	 width: 100%;
	 border: 0;
	 border-bottom: 2px solid #9b9b9b;
	 outline: 0;
	 font-size: 1.8rem;
     font-weight: 400;
	 color: var(--color-text-dark-2);
	 padding: 0.7rem 0;
	 background: transparent;
	 transition: border-color 0.2s;
}
 .form__field::placeholder {
	 color: transparent;
}
 .form__field:placeholder-shown ~ .form__label {
	 font-size: 1.8rem;
	 cursor: text;
	 top: 2rem;
     font-weight: 300;
}
 .form__label {
	 position: absolute;
	 top: 0;
	 display: block;
	 transition: 0.2s;
	 font-size: 1.4rem;
	 color: #9b9b9b;
}
 .form__field:focus {
	 padding-bottom: 0.6rem;
	 font-weight: 400;
	 border-width: 2px;
	 border-image: linear-gradient(to right, var(--color-grey-dark-1), var(--color-grey-dark-1));
	 border-image-slice: 1;
}
 .form__field:focus ~ .form__label {
	 position: absolute;
	 top: 0;
	 display: block;
	 transition: 0.2s;
	 font-size: 1.4rem;
	 color: var(--color-grey-dark-1);
	 font-weight: 400;
}

/* reset input */
 .form__field:required, .form__field:invalid {
	 box-shadow: none;
}


.resume-label {
    font-size: 1.6rem;
    font-weight: 200;
    padding: 0.7rem 2rem 0.6rem 2rem;
    border-radius: 2px;
    cursor: pointer;
    background-color: var(--color-grey-light-4);
    transition: all 0.2s ease;
}
.resume-label:hover {
 background-color: var(--color-primary);
 color: var(--color-background-light-2);
}

.resume-file-input{
    display: flex;
    flex-wrap: nowrap;
    align-items: center;
    border-bottom: 2px solid #9b9b9b;
    padding: 0.6rem 0;
}

.file-name{
    font-size: 1.6rem;
    white-space: nowrap; /* Prevent text from wrapping */
    overflow: hidden; /* Hide any overflow */
    text-overflow: ellipsis;
    display: inline-block;
    margin-left: 1rem;
    max-width: 40vw;
}

.small-text{
    font-size: 1.4rem;
    position: relative;
    top: 0.4rem;
    color: var(--color-background-tertiary-light);
}

.hidden{
    display: none;
}

.form-submit-row{
    display: flex;
    justify-content:center;
}
.submit{
    align-self: center;
    margin: 3rem 2rem;  
}

.danger{
    border-color: var(--color-background-tertiary-light);
}


#loading {
    position: absolute;
    top: 0;
    background-color: #ffffff;
    z-index: 10;
    width: 100%;
    height: 100%;
    transition: opacity 0.3s ease-out;
  }

  #submit-loading{
    display: none;
    position: absolute;
    width: 100%;
    z-index: 2;
    background-color: #00000075;
    transition: opacity 0.3s ease-out;
  }
  
  .loading-icon {
    width: 50px;
    height: 50px;
    border: 5px solid var(--color-tertiary);
    border-radius: 50%;
    border-top: 0.5rem solid var(--color-primary);
    animation: spin 1s linear infinite;
    margin: 50vh auto;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  .section_hidden{
    opacity: 0;
    transform: translateY(10rem);
  }

@keyframes popUp {
  from {
    transform: translateY(3rem);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.bottom-up {
  animation-name: popUp;
  animation-duration: 0.3s;
  animation-timing-function: ease-out;
  animation-fill-mode: forwards;
  opacity: 0;
}

.tag:nth-child(1) {
  animation-delay: 0.3s;
}

.tag:nth-child(2) {
  animation-delay: 0.5s;
}

.tag:nth-child(3) {
  animation-delay: 0.7s;
}

.tag:nth-child(4) {
  animation-delay: 0.9s;
}


.landing-element {
    animation-name: land;
    animation-duration: 0.4s;
    animation-timing-function: ease-out;
    animation-fill-mode: forwards;
    opacity: 0;
    }

    @keyframes land {
      0% {
        transform: scale(1.3);
        opacity: 0; /* Starting position, completely hidden outside the right edge */
      }
      100% {
        transform: scale(1);
        opacity: 1;/* Ending position, lands on the left edge */
      }
    }

    .landing-element:nth-child(1) {
  animation-delay: 0.4s;
}

.landing-element:nth-child(2) {
  animation-delay: 0.6s;
}

#lottie-container{
    width: 70vw;
    margin: 0 auto;
}

.job-closed-heading{
    font-size: 4rem;
    font-weight: 600;
    color: var(--color-text-dark-2);
    margin: 0;
    text-transform: uppercase;
}

.info-secondary{
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2rem;
}

.info-secondary-text{
    display: flex;
    flex-direction: column;
    align-items: center;
}

.closed-text{
    font-size: 1.6rem;
    margin: 0.3rem;
    color: var(--color-secondary);
}


#bs64_img_0{
        max-width: 100%;
        height: auto;
    }

@media only screen and (max-width: 56em) {

    .header{
        align-items: start;
        height: auto;
    }

    .action-btns{
        padding-top: 3rem;
        margin-top: 0;
    }

    .job-description {
        grid-column: full-start / full-end;
        padding: 2rem;
    } 

    .cards{
    grid-column: full-start / full-end;
    grid-row: 3 / -1;
    }

    .job-apply{
        grid-column: full-start / full-end;
    }
    .tags{
        flex-direction: column;
    }

    .job-name{
        font-size: 4rem;
    }

   
}

@media only screen and (max-width: 32em) {
    .header{
        flex-direction: column;
        align-items: flex-start;
        
    }

    .header-main{
        width: 100%;
        margin: 0;
    }

    .action-btns{
        width: 100%;
        margin-bottom: 1rem;
        padding-top: 1rem;
        /* margin-top: 1rem; */
        /* margin-left: 1rem; */
    }

    .action-btns button {
        margin: 0 auto;
    }

    .custom-btn{
        width: 100%;
    }

    .job-description {
        /* grid-column: full-start / full-end; */
        padding: 0rem;
        /* grid-template-rows: 6rem calc(100vh - 6rem);  */
    } 

    .job-apply{
        margin: 0;
    }

    .form-row{
        flex-direction: column;
    }

    .form__group {
        margin: 0rem;
    }

    .container{
        margin: 0;
    }

    .form{
        /* max-width: auto; */
        width: 100%;
    }

}


@media only screen and (max-width: 20em) {
    .job-name{
        font-size: 2.6rem;
        margin: 3rem 0 0 0;
    }

    


}

    </style>
    
</head>
<body>
    <div id="parent-container">
    <script>
        window.scrollTo(0, 0);
        document.body.style.overflow = 'hidden';
    </script>
    <nav>
            
    </nav>
    <div id="loading">
        <div class="loading-icon"></div>
    </div>
    
    <header class="header-container">
        <div class="header">
            <div class="header-main">
                <h1 class="job-name"></h1>
                <div class="tags">
                    <span class="tag" id="job-location"></span>
                    <span class="tag" id="job-type"></span>
                    <span class="tag" id="job-department"></span>
                    <span class="tag" id="job-industry"></span>
                </div> 
            </div>
            <div class="action-btns">
                <button type="button" class="custom-btn btn-apply landing-element" title="Apply" id="apply-button-top">Apply</button>
                <button type="button" class="custom-btn btn-back landing-element" title="Back" id="back-button-top">Back</button>
            </div>
        </div>
    </header>
    <main class="container">
        <div class="container-small job-description">
            
        </div>
        <div class="container-small job-apply">
            <hr class="divider divider-large">
            <h2 class="apply-to-job">
                Job Application Form
            </h2>
            <form class="form" method="post">
            <div class="form-row">
                <div class="form__group field">
                    <input type="input" class="form__field" placeholder="First Name" name="firstname" id='firstname' minlength="1" required/>
                    <label for="firstname" class="form__label">First Name</label>
                    <span class="small-text hidden">First Name field is required</span>
                </div>
                <div class="form__group field">
                    <input type="input" class="form__field" placeholder="Last Name" name="lastname" id='lastname' minlength="1" required/>
                    <label for="lastname" class="form__label">Last Name</label>
                    <span class="small-text hidden">Last Name field is required</span>
                </div>
            </div>
            <div class="form-row">
                <div class="form__group field">
                    <input type="input" class="form__field" placeholder="Email" name="email" id='email' minlength="1" required/>
                    <label for="email" class="form__label">Email</label>
                    <span class="small-text hidden">Email field is required</span>
                </div>
                <div class="form__group field">
                    <input type="input" class="form__field" placeholder="Phone" name="phone" id='phone' />
                    <label for="phone" class="form__label">Phone</label>
                    <span class="small-text hidden"></span>
                </div>
            </div>
            <div class="form-row">
                <div class="form__group field">
                    <input type="input" class="form__field" placeholder="City" name="city" id='city' />
                    <label for="city" class="form__label">City</label>
                    <span class="small-text hidden"></span>
                </div>
            </div>   
            <div class="form-row">
                <div class="form__group resume">
                    <input type="file" id="file" name="resume" title="resume"
                    accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                    hidden required>
                    <div class="resume-file-input">
                        <label for="file" class="resume-label">Resume</label>
                        <span class="file-name"></span>
                    </div>
                    <span class="small-text hidden">Resume field is required</span>
                </div>
            </div>
            
            <div class="form-submit-row">
                <button type="submit" class="custom-btn btn-submit submit" id="form-submit">Submit</button>
            </div>
        </form>
        <div id="submit-loading">
            <div class="loading-icon"></div>
        </div>
        </div>
        <div class="cards">
            <div class="info-card result">
                <strong class="card-text strong result-text">Hervorragende Ergebnisse</strong>
                <p class="card-text result-text">Die Hingabe zu unseren grundlegenden Werten, den individuellen und persönlichen Service,
                    welchen wir jedem Bewerber und Unternehmen bieten,
                    sowie dem Engagement unserer Mitarbeiter,
                    welche die Kernwerte (Hyperlink to „Unsere Werte“) jeden Tag verkörpern,
                    führen zu hervorragenden Ergebnissen.</p>
            </div>
            <div class="info-card list">
                
                <strong class="card-text  strong">Wie geht es nach Ihrer Bewerbung weiter?</strong>
                <ol class="card-order-list">
                    <li class="card-text">Wir führen mit Ihnen ein persönliches oder virtuelles Vorstellungsgespräch, um Ihre Ziele, Wünsche, sowie Anforderungen
                        an den künftigen Arbeitgeber besser kennenzulernen und erläutern Ihnen alle wichtigen Details zur ausgeschriebenen Stelle.</li>
                    <li class="card-text">Wir begleiten Sie von Anfang bis Ende und darüber hinaus. Wir Briefen und Coachen Sie individuell vor Ihrem Bewerbungsgespräch,</li>
                    <li class="card-text">damit Sie optimal vorbereitet sind. Auf Wunsch führen wir gerne ein kostenloses CV-Coaching mit Ihnen durch.</li>
                    <li class="card-text">Wir erzielen für Sie beste Ergebnisse. Dabei übernehmen wir die Vertragsverhandlung und stehen Ihnen kompetent zur Seite.</li>
                    <li class="card-text"><strong>Herzlichen Glückwunsch zu Ihrem Traumjob!</strong> Wir stehen Ihnen selbstverständlich auch im Anschluss einer erfolgreichen Vermittlung zur Verfügung</li>
                    <li class="card-text">und freuen uns darüber, wenn Sie Ihre Erfahrung mit uns teilen.</li>
                </ol>
            </div>
            <div class="info-card contact">
                <strong class="card-text strong">Ihre Bewerbung wird stets vertraulich behandelt.</strong>
                <p class="card-text">Sie haben Fragen oder Anregungen? Zögern Sie nicht uns zu kontaktieren und schreiben Sie uns:
                    <a class="contact-email" href="mailto:candidate-service@paulnewstone.com">candidate-service@paulnewstone.com</a></p>
                <hr class="divider">
                <ul class="social-icons">
                    <li>
                      <a class="facebook" href="#">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <i class="fab fa-facebook-f" aria-hidden="true"></i>
                      </a>
                    </li>
                    <li>
                      <a class="twitter" href="#">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <i class="fab fa-twitter" aria-hidden="true"></i>
                      </a>
                    </li>
                    <li>
                      <a class="instagram" href="#">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <i class="fab fa-instagram" aria-hidden="true"></i>
                      </a>
                    </li>
                    <li>
                      <a class="google" href="#">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                        <i class="fab fa-google" aria-hidden="true"></i>
                      </a>
                    </li>
                </ul>
            </div>
        </div>
    </main>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    </div>
    <script>
        
        // Data Module
const DataModule = (() => {
    const urlParams = new URLSearchParams(window.location.search);
    let job = {};
    let accountId = 20390;
    const allowDuplicates = "False"
    let jobId = urlParams.get('job_id');
    let SOLUTION_API_BASE_URL = 'https://solutions-test.recruitcrm.io'
    
    const getJobById = async () => {
      try {
        const response = await fetch(`${SOLUTION_API_BASE_URL}/jobs/by-id/${accountId}?job_id=${jobId}`);
        const data = await response.json();
        job = data;
        return data;
      } catch (error) {
        console.log('Error fetching job data:', error);
        return [];
      }
    };

    const applyToJob = async (candidateData) => {
        let applyUrl = SOLUTION_API_BASE_URL + "/candidates/apply-job/"
        applyUrl += accountId;
        applyUrl += "?job_slug=" + job.job_slug;
        applyUrl += "&allow_duplicates=" + allowDuplicates;
        applyUrl += "&updated_by=" + job.owner;
        const objTemp = {
            'first_name' : candidateData.firstname,
            'last_name' : candidateData.lastname,
            'email' : candidateData.email,
            'contact_number' : candidateData.phone,
            'city' : candidateData.city,
            'source' : 'website'
        }

        let candidate = new FormData();

        candidate.append("candidate_data", JSON.stringify(objTemp));
        candidate.append("candidate_resume", candidateData.resume);
        
        
        console.log(applyUrl);
        console.log(Object.fromEntries(candidate));

    //   try {
    //     const response = await fetch(applyUrl);
    //     const data = await response.json();
    //     return data;
    //   } catch (error) {
    //     console.log('Error occured:', error);
    //     return
    //   }
    };

    return {
      getJobById,
      applyToJob,
    };
  })();
  
  
  // UI Module
const UIModule = (() => {
    const jobName = document.querySelector('.job-name');
    const jobLocation = document.querySelector('#job-location');
    const jobType = document.querySelector('#job-type');
    const jobDepartment = document.querySelector('#job-department');
    const jobIndustry = document.querySelector('#job-industry');
    const jobDescriptionContainer = document.querySelector(".job-description");
  
    const startLoading = () => {
      const loading = document.getElementById('loading');
      loading.style.opacity = '1';
      loading.style.display = 'block';
    }
    
    const stopLoading = () => {
      const loading = document.getElementById('loading');
      loading.style.opacity = '0';
      setTimeout(function() {
            loading.style.display = 'none';
      }, 300);
    }

    const startSubmitLoading = () => {
      const loading = document.getElementById('submit-loading');
      loading.style.opacity = '1';
      loading.style.display = 'block';
    }
    
    const stopSubmitLoading = () => {
      const loading = document.getElementById('submit-loading');
      loading.style.opacity = '0';
      setTimeout(function() {
            loading.style.display = 'none';
      }, 300);
    }
  

    const paintJobDetailsViewer = (job) => {
        jobName.innerHTML = job.name?.replace(/\s*\([^)]*\)\s*/g, '');
        jobLocation.innerHTML = '<i class="ph ph-globe-hemisphere-east icon"></i>' + job.city
        jobType.innerHTML = '<i class="ph ph-briefcase icon"></i>' + job.job_type
        jobIndustry.innerHTML = '<i class="ph ph-factory icon"></i>' + job.custom_fields?.find(field => field.field_name === 'Industry').value
        jobDescriptionContainer.innerHTML = job.job_description_text;
        
        let department = job.custom_fields?.find(field => field.field_id === '4').value.toLowerCase();
        let icon = 'ph-buildings';
        if (department === 'office support') {
            icon = 'ph-archive';
        } else if (department === 'finance & accounting') {
            icon = 'ph-wallet';
        } else if (department === 'human resources') {
            icon = 'ph-users';
        } else if (department === 'sales') {
            icon = 'ph-chart-line-up';
        }
        jobDepartment.innerHTML = `<i class="ph ${icon} icon"></i>` + department
    }

    const jobNotFound = () => {
        document.getElementById('parent-container').innerHTML = '<div id="lottie-container"></div>'
        const animationContainer = document.getElementById('lottie-container');
        const animationData = './animation.json'

        const animation = lottie.loadAnimation({
        container: animationContainer,
        renderer: 'canvas', // You can choose 'svg', 'canvas', or 'html'
        loop: true,
        autoplay: true,
        path: animationData
        });

        const info = document.createElement('div');
        info.className = 'info-secondary';
        document.getElementById('parent-container').appendChild(info);

        //heading
        let closedHeading = document.createElement('h1');
        closedHeading.textContent = 'Job is Closed'
        closedHeading.className = 'job-closed-heading'
        info.appendChild(closedHeading);

        //text
        let closedText = document.createElement('div');
        closedText.className='info-secondary-text'

        let line1 = document.createElement('p');
        line1.textContent = 'We\'re sorry, but the job you were looking for has been filled.'
        line1.className = 'closed-text'
        closedText.appendChild(line1);

        let line2 = document.createElement('p');
        line2.textContent = 'Thank you for your interest.'
        line2.className = 'closed-text'
        closedText.appendChild(line2);


        info.appendChild(closedText);

        //button
        const button = document.createElement('button');

        // Set the button attributes
        button.setAttribute('type', 'button');
        button.setAttribute('class', 'custom-btn btn-submit');
        button.setAttribute('title', 'Back');
        button.setAttribute('id', 'back-button-top');
        button.onclick = () => {
            window.location = '/index.html'
        }

        // Set the button text
        button.innerText = 'Back';
        info.appendChild(button);
    }

    const thankYou = () => {
        document.getElementById('parent-container').innerHTML = '<div id="lottie-container"></div>'
        const animationContainer = document.getElementById('lottie-container');
        const animationData = './thankyou.json'

        const animation = lottie.loadAnimation({
        container: animationContainer,
        renderer: 'canvas', // You can choose 'svg', 'canvas', or 'html'
        loop: true,
        autoplay: true,
        path: animationData
        });

        const info = document.createElement('div');
        info.className = 'info-secondary';
        document.getElementById('parent-container').appendChild(info);

        //heading
        let closedHeading = document.createElement('h1');
        closedHeading.textContent = 'Thank you for Applying'
        closedHeading.className = 'job-closed-heading'
        info.appendChild(closedHeading);

        //text
        let closedText = document.createElement('div');
        closedText.className='info-secondary-text'

        let line1 = document.createElement('p');
        line1.textContent = 'We\'re sorry, but the job you were looking for has been filled.'
        line1.className = 'closed-text'
        closedText.appendChild(line1);

        let line2 = document.createElement('p');
        line2.textContent = 'Thank you for your interest.'
        line2.className = 'closed-text'
        closedText.appendChild(line2);


        info.appendChild(closedText);

        //button
        const button = document.createElement('button');

        // Set the button attributes
        button.setAttribute('type', 'button');
        button.setAttribute('class', 'custom-btn btn-submit');
        button.setAttribute('title', 'Back');
        button.setAttribute('id', 'back-button-top');
        button.onclick = () => {
            window.location = '/index.html'
        }

        // Set the button text
        button.innerText = 'Back';
        info.appendChild(button);
    }
    
    return {
      startLoading,
      stopLoading,
      startSubmitLoading,
      stopSubmitLoading,
      paintJobDetailsViewer,
      jobNotFound,
      thankYou,
    };
  })();
  

  // Event Module
  const EventModule = ((dataModule, uiModule) => {
    const applyBtnTop = document.getElementById("apply-button-top");
    const backBtnTop = document.getElementById("back-button-top");
    const submitBtn = document.getElementById("form-submit");
    const applyForm = document.querySelector(".form");
    const formInputs = document.querySelectorAll("input");
    const descriptionContainer = document.querySelector(".job-description");
    const applyFormContainer = document.querySelector(".job-apply")
    const file = document.getElementById("file");
    const cards = document.querySelectorAll(".info-card");
    const card1 = document.querySelector(".info-card.result");
    const card2 = document.querySelector(".info-card.list");
    const card3 = document.querySelector(".info-card.contact");
    
    const showApplyForm = (entries, observe) => {
        const [entry] = entries
        if(!entry.isIntersecting) return
        entry.target.classList.remove("section_hidden");
        // observe.unobserve(entry.target);
    }

    const slideBottomUp = (entries, observe) => {
        const [entry] = entries
        if(!entry.isIntersecting) return 
        entry.target.classList.remove("section_hidden")
        observe.unobserve(entry.target);
    }

     const applicationFormObserver = new IntersectionObserver(showApplyForm, {
        root:null,
        threshold: 0.3
     })

     const informationCard1Observer = new IntersectionObserver(slideBottomUp, {
        root:null,
        threshold: 0.05
     })

     const informationCard2Observer = new IntersectionObserver(slideBottomUp, {
        root:null,
        threshold: 0.05
     })

     const informationCard3Observer = new IntersectionObserver(slideBottomUp, {
        root:null,
        threshold: 0.05
     })  
  
  
    const handlePageLoad = async () => {
      uiModule.startLoading();
      const job = await dataModule.getJobById();
      uiModule.stopLoading();
      if(job.job_id){
        uiModule.paintJobDetailsViewer(job);
      } else {
        //closed job code
        UIModule.jobNotFound();
      }
      
     
      document.body.style.overflow = 'auto';
      applyFormContainer.classList.add("section_hidden");
      document.querySelectorAll(".tag").forEach(tag => tag.classList.add("bottom-up"))
      descriptionContainer.classList.add("bottom-up");
      formInputs.forEach(input => { input.addEventListener("input", removeErrorMessage); });
    };



    const removeErrorMessage = (e) => {
        e.target.nextElementSibling.nextElementSibling.className = "small-text hidden";
        e.target.classList.remove("danger");
    }

    const handleApplyBtnTopClick = () => {
        applyFormContainer.scrollIntoView({behavior:"smooth"})
    }

    const handleBackBtnTopClick = () => {
        window.location = '/index.html'
    }

    const isEmailValid = () => {
    const EMAIL_FORMAT = /^\w+([\.-]?\w+)*@[a-z0-9.-]+\.[a-z]{2,5}$/;
    const email = document.getElementById("email");
    const errorLabel = email.nextElementSibling.nextElementSibling;
    const trimmedEmail = email.value.trim();

    if (trimmedEmail === "") {
        errorLabel.textContent = "Email field is required";
        errorLabel.className = "small-text";
        email.classList.add("danger")
        return false;
    }

    if (!EMAIL_FORMAT.test(trimmedEmail)) {
        errorLabel.textContent = "Email format is invalid";
        errorLabel.className = "small-text";
        email.classList.add("danger")
        return false;
    }

    return true;
    };
    
    const validateResume = () => {

        const file = document.getElementById("file");
        const fileNameHolder = document.querySelector(".file-name");
        const fileInput = document.querySelector(".resume-file-input");
        const errorLabel = file.nextElementSibling.nextElementSibling;

        if (file.value === "") {
            errorLabel.textContent = "Resume field is required";
            errorLabel.className = "small-text";
            fileInput.classList.add("danger")
            fileNameHolder.textContent = ''
            return false;
        }

        resume = file.files[0];
        const fileMb = resume.size / 1024 ** 2;
        if (fileMb > 8) {
            errorLabel.textContent = "Resume size should be less than 8MB";
            errorLabel.className = "small-text";
            fileInput.classList.add("danger")
            fileNameHolder.textContent = ''
            return false;
        }else{
            fileNameHolder.textContent = resume.name // resume.name.length > 30 ? resume.name.slice(0, 15) + '...' + resume.name.slice(-8) : resume.name;
            fileInput.classList.remove("danger")
            fileNameHolder.className = "file-name";
        }

        return true;
    };

    const validateInput = (inputId) => {
        const input = document.getElementById(inputId);
        if (input.value == "") {
            input.nextElementSibling.nextElementSibling.className = "small-text";
            inputId != 'file' && (input.classList.add("danger"));
            return false;
        }
        return true;
    };

    const handleSubmitBtnClick = async (e) => {
        e.preventDefault();
        uiModule.thankYou();
        return
        uiModule.startSubmitLoading();
        const jobApplicationForm = new FormData(applyForm);
        const objCandidate = Object.fromEntries(jobApplicationForm);
        const formInputs = Array.from(document.querySelectorAll('input[name]:not([name="resume"])'));
        let isValid = true;

        formInputs.forEach(input => {
            input.value = input.value.trim();
        });

        const formFields = {
            "firstname": validateInput("firstname") , 
            "lastname": validateInput("lastname") , 
            "file": validateResume(), 
            "email": isEmailValid()
        }

        isValid = !Object.values(formFields).includes(false)


        if (!isValid) {
            for (let key in formFields) {
                if(formFields[key] == false){
                    document.getElementById(key).scrollIntoView({behavior:  'smooth', block: 'start'});
                    return;
                }
            }
            return;
        }

        //handle form submit 
        console.log(objCandidate);
        uiModule.startSubmitLoading();
        // const submitResponse = await dataModule.applyToJob(objCandidate);
        // uiModule.stopSubmitLoading();
        // uiModule.thankYou();
        // if(submitResponse && submitResponse.status == 201) {
        //     uiModule.thankYou();
        // }else{
        //     console.log('Error: ' + submitResponse);
        // }
        
    };

    return {
      init: () => {
        window.addEventListener('DOMContentLoaded', handlePageLoad);
        cards.forEach(card => card.classList.add("section_hidden"))
        
        applyBtnTop.addEventListener('click', handleApplyBtnTopClick);
        backBtnTop.addEventListener('click', handleBackBtnTopClick);
        submitBtn.addEventListener('click', handleSubmitBtnClick);
        applicationFormObserver.observe(applyFormContainer);
        informationCard1Observer.observe(card1);
        informationCard2Observer.observe(card2);
        informationCard3Observer.observe(card3);
        file.addEventListener("change", validateResume)
      },
    };
  })(DataModule, UIModule);
  

  
  // Initialize the application
  EventModule.init();
  




    </script>
</body>
</html>