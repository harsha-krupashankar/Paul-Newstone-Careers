<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jobs</title>
    <link rel="stylesheet" href="index_styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <!-- Select2 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">

</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <section class="header">
        <div id="bg">

        </div>
        <div class="overlay d-flex align-items-center justify-content-center">
            <div class="container filter-box">
                <div class="row align-items-center justify-content-center">
                    <div class="col-md-3">
                        <div class="input-group">
                            <input type="text" class="form-control search-box" placeholder="Search Jobs"
                                aria-label="Username" aria-describedby="basic-addon1">
                        </div>
                    </div>
                    <div class="col-md-3">
                        <select id="multi-select1" class="form-control country-search" multiple="multiple">
                            <option value="option1">Option 1</option>
                            <option value="option2">Option 2</option>
                            <option value="option3">Option 3</option>
                            <option value="option4">Option 4</option>
                            <option value="option5">Option 5</option>
                            <option value="option6">Option 6</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select id="multi-select2" class="form-control" multiple="multiple">
                            <option value="option1">Option 1</option>
                            <option value="option2">Option 2</option>
                            <option value="option3">Option 3</option>
                            <option value="option4">Option 4</option>
                            <option value="option5">Option 5</option>
                            <option value="option6">Option 6</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-red btn-block">Search</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <main>
        <div class="container d-flex jobs">
            <div class="left-panel">
                <div class="section-heading">
                    <h3>Filter Jobs</h3>
                </div>
                <div class="department-dropdown">
                    <select id="multi-select3" class="form-control department-search" multiple="multiple">
                        <option value="option1">Option 1</option>
                        <option value="option2">Option 2</option>
                        <option value="option3">Option 3</option>
                        <option value="option4">Option 4</option>
                        <option value="option5">Option 5</option>
                        <option value="option6">Option 6</option>
                    </select>
                </div>
                <div class="industry-dropdown">
                    <select id="multi-select4" class="form-control industry-search" multiple="multiple">
                        <option value="option1">Option 1</option>
                        <option value="option2">Option 2</option>
                        <option value="option3">Option 3</option>
                        <option value="option4">Option 4</option>
                        <option value="option5">Option 5</option>
                        <option value="option6">Option 6</option>
                    </select>
                </div>
                <div class="clear-all">
                    <button type="button" class="btn btn-outline-black btn-block clear-btn">Clear all</button>
                </div>
            </div>

            <div class="job-listings">
                <div class="jobs-count">
                    <h3><span id="job-count">0</span> Jobs found</h3>
                </div>
                <div class="job-cards">

                </div>
            </div>
    </main>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#multi-select1').select2({
                placeholder: 'Search Country',
                allowClear: true
            });
            $('#multi-select2').select2({
                placeholder: 'Search City',
                allowClear: true
            });
            $('#multi-select3').select2({
                placeholder: 'All Departments',
                allowClear: true
            });
            $('#multi-select4').select2({
                placeholder: 'All Industries',
                allowClear: true
            });
        });
    </script>

    <script>

        var displayedJobCount = 0;
        var next_page_url = '';

        // To add overlay on the background image on scroll
        let headerBg = document.getElementById("bg");
        window.addEventListener("scroll", function () {
            headerBg.style.opacity = 1 - +window.pageYOffset / 550 + "";
            headerBg.style.top = +window.pageYOffset + "px";
        });


        // Function to check if an element is in the viewport with an offset
        function isInViewport(element, offset) {
            var rect = element.getBoundingClientRect();
            var windowHeight = window.innerHeight || document.documentElement.clientHeight;
            var windowWidth = window.innerWidth || document.documentElement.clientWidth;

            // Adjust the top and bottom boundaries with the offset
            var topBound = 0 - offset;
            var bottomBound = windowHeight + offset;

            return (
                rect.top >= topBound &&
                rect.left >= 0 &&
                rect.bottom <= bottomBound &&
                rect.right <= windowWidth
            );
        }


        // Function to add the slide-up class to job cards in the viewport with an offset
        function animateJobCards() {
            var jobCards = document.getElementsByClassName('job-card');
            var offset = 150; // Adjust the offset value as needed

            for (var i = 0; i < jobCards.length; i++) {
                if (isInViewport(jobCards[i], offset)) {
                    jobCards[i].classList.add('slide-up');
                }
            }
        }


        // Add event listener to animate job cards on scroll
        window.addEventListener('scroll', animateJobCards);
        window.addEventListener('resize', animateJobCards);

        // Animate job cards on initial page load
        animateJobCards();

        async function fetchJobsAndCreateCards(endpoint) {
            try {
                const response = await fetch(endpoint);
                if (!response.ok) {
                    throw new Error('Failed to fetch jobs');
                }
                const data = await response.json();
                if (data) {
                    createJobCards(data);
                }
            } catch (error) {
                console.error(error);
            }
        }

        function createJobCards(data) {
            debugger

            // Get the job-cards container
            var jobCardsContainer = document.querySelector('.job-cards');

            // Loop through the data array
            data["data"].forEach(function (job) {
                // Extract job name without the content inside parentheses
                var jobName = job.name.replace(/\s*\([^)]*\)\s*/g, '');


                // Get department value and convert to lowercase
                var department = job.custom_fields.find(field => field.field_id === '4').value.toLowerCase();

                // Create a new job card element
                var jobCard = document.createElement('div');
                jobCard.classList.add('job-card');

                // Add department-specific class to the job card
                if (department === 'office support') {
                    jobCard.classList.add('card-office-support');
                } else if (department === 'finance & accounting') {
                    jobCard.classList.add('card-finance-accounting');
                } else if (department === 'human resources') {
                    jobCard.classList.add('card-human-resource');
                } else if (department === 'sales') {
                    jobCard.classList.add('card-sales-marketing');
                }

                // Add the job card HTML content
                jobCard.innerHTML = `
                    <div class="info-div">
                        <div class="job-name">
                        <h4>${jobName}</h4>
                        </div>
                        <div class="job-info">
                        <div class="location">
                            <ion-icon name="earth-outline"></ion-icon>
                            <p>${job.city} - ${job.country}</p>
                        </div>
                        <div class="division">
                            <ion-icon name="briefcase-outline"></ion-icon>
                            <p>${job.custom_fields.find(field => field.field_id === '4').value}</p>
                        </div>
                        ${job.custom_fields.find(field => field.field_name === 'Industry' && field.value !== 'None') ? `
                            <div class="industry">
                            <ion-icon name="business-outline"></ion-icon>
                            <p>${job.custom_fields.find(field => field.field_name === 'Industry').value}</p>
                            </div>
                        ` : ''}
                        </div>
                    </div>
                    <div class="btn-div">
                        <div class="apply-btn">
                        <button type="button" class="btn btn-black btn-block">Apply Now</button>
                        </div>
                    </div>
                    `;

                // Append the job card to the job-cards container
                jobCardsContainer.appendChild(jobCard);
            });
            displayedJobCount += data.count;
            document.querySelector('#job-count').innerHTML = displayedJobCount

            // Add .view-more div if 'next_page_url' exists
            if (data.hasOwnProperty('next_page_url') && !document.querySelector('.view-more')) {
                var viewMoreContainer = document.createElement('div');
                viewMoreContainer.classList.add('view-more');
                viewMoreContainer.innerHTML = `
                    <button type="button" class="btn btn-outline-black view-more-btn"  onclick="fetchNextPageJobs()">View More</button>
                `;
                jobCardsContainer.appendChild(viewMoreContainer);

                next_page_url = data.next_page_url;
            }
        }

        function fetchNextPageJobs() {
            var viewMoreDiv = document.querySelector('.view-more');
            if (viewMoreDiv) {
                viewMoreDiv.parentNode.removeChild(viewMoreDiv);
            }
            fetchJobsAndCreateCards(next_page_url);
        }

        // Call the combined function to fetch jobs and create job cards
        fetchJobsAndCreateCards('https://solutions-test.recruitcrm.io/jobs/20390?limit=10&keys=custom_field[4],custom_field[5]');



    </script>
</body>

</html>